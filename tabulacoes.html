<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" type="image/png" href="img/operador-de-telemarketing.png">
  <title>Tabula√ß√µes</title>
  <style>
    :root{
      --bg:#0f1113; --panel:#15181b; --panel-2:#1b2024; --text:#f5f7fa; --muted:#aab0b6;
      --border:#22292f; --badge-bg:#21272d; --badge-border:#2a3138;
      --accent:#ff6d00; --accent-2:ff6d00; --shadow:0 12px 34px rgba(0,0,0,.35);
    }
    body[data-theme="light"]{
      --bg:#fff; --panel:#fff; --panel-2:#f7f7f8; --text:#1b1f24; --muted:#666;
      --border:#e5e7eb; --badge-bg:#f3f4f6; --badge-border:#e5e7eb;
      --accent:#ff6d00; --accent-2:#ffa000; --shadow:0 8px 20px rgba(0,0,0,.08);
    }

    *{ box-sizing:border-box }
    body{
      margin:0; font-family:system-ui,Roboto,Arial,sans-serif;
      background:var(--bg); color:var(--text);
      min-height:100vh; display:flex; justify-content:center; padding:20px;
    }
    .container{ width:100%; max-width:960px }

    header{ display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:8px; margin-bottom:14px }
    header h1{ margin:0; font-size:22px; color:var(--accent) }
    .toolbar{ display:flex; gap:8px; flex-wrap:wrap; justify-content:center; width:100%; }

    .select,.badge{
      border:1px solid var(--badge-border); background:var(--panel-2); color:var(--text);
      padding:8px 12px; border-radius:10px; cursor:pointer;
    }

    /* pesquisa centralizada */
    #searchWrapper {
      display: flex;
      justify-content: center;
      margin-top: 12px;
      width: 100%;
    }
    #searchInput {
      flex: 0 1 480px;
      border:1px solid var(--badge-border);
      background:var(--panel-2);
      color:var(--text);
      padding:10px 14px;
      border-radius:12px;
    }

    /* ===== BLOCO CARDS (maiores) ===== */
    .stack-stage {
      display: flex;
      justify-content: center;
      align-items: center;
      overflow-x: hidden;
      min-height: calc(100vh - 220px);
    }
    .stack-container {
      display: flex;
      gap: 22px;
      overflow: hidden;
      position: relative;
      width: 100%;
      padding: 20px 0;
      justify-content: center;
    }
    .tab-card {
      flex: 0 0 380px;
      max-width: 420px;
      min-height: 320px;
      background: var(--panel-2);
      border: 2px solid var(--accent); /* borda igual lista */
      border-radius: 24px;
      padding: 28px;
      box-shadow: 0 8px 22px rgba(0,0,0,.25);
      transition: transform .4s ease, opacity .4s ease, box-shadow .3s ease;
      position: relative;
      cursor: grab;
      animation: slideRight 12s linear infinite;
    }
    .tab-card:hover {
      box-shadow: 0 12px 28px rgba(0,0,0,.35);
      transform: translateY(-4px);
    }
    .tab-card h3 {
      margin: 0 0 16px;
      padding-bottom: 10px;
      font-size: 22px;
      font-weight: 700;
      color: var(--accent);
      text-align: center;
      border-bottom: 1.5px solid var(--border); /* separador t√≠tulo/descri√ß√£o */
    }
    .tab-card p {
      margin: 0;
      font-size: 16px;
      line-height: 1.6;
      color: var(--text);
      white-space: pre-wrap;
    }

    /* Remove a limita√ß√£o da √°rea de cards */
    .stack-stage {
      width: 100vw;
      margin-left: calc(50% - 50vw);  /* ‚Äúsangra‚Äù pra fora do .container */
      margin-right: calc(50% - 50vw);
    }

    /* pausa o carrossel quando houver card em zoom */
    .stack-stage.zoom-active .stack-container {
      animation-play-state: paused !important;
    }

    /* anima√ß√£o indo para direita */
    @keyframes slideRight {
      0%   { transform: translateX(-140%); opacity: 0; }
      10%  { transform: translateX(0); opacity: 1; }
      80%  { transform: translateX(140%); opacity: 1; }
      100% { transform: translateX(200%); opacity: 0; }
    }

    /* quando filtrado -> centraliza */
    .tab-card.centered {
      animation: fadeInCenter .5s ease forwards !important;
      transform: translateX(0) !important;
      opacity: 1 !important;
      margin: 0 auto;
    }
    @keyframes fadeInCenter {
      from { transform: scale(.8); opacity: 0; }
      to   { transform: scale(1); opacity: 1; }
    }

    /* zoom */
    .zoom-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: var(--badge-bg);
      border: 1px solid var(--badge-border);
      border-radius: 50%;
      color: var(--text);
      font-size: 16px;
      padding: 5px 7px;
      cursor: pointer;
      opacity: 0;
      transition: opacity .25s ease;
    }
    .tab-card:hover .zoom-btn { opacity: 1; }

    .tab-card.zoomed {
      position: fixed !important;
      top: 50% !important;
      left: 50% !important;
      transform: translate(-50%,-50%) scale(1.15) !important;
      width: 90% !important;
      max-width: 720px !important;
      height: auto !important;
      max-height: 90vh !important;
      cursor: default;
      z-index: 3000 !important;
      box-shadow: 0 25px 60px rgba(0,0,0,.6);
      animation: none !important;
    }

    /* bot√£o voltar */
    .bottom-back{
      position: fixed;
      left: 50%;
      bottom: 20px;
      transform: translateX(-50%);
      z-index: 1900;
    }
    .bottom-back a{
      display: inline-block;
      background: var(--panel);
      border: 2px solid var(--accent);
      color: var(--accent);
      padding: 12px 22px;
      border-radius: 20px;
      font-size: 15px;
      font-weight: 600;
      text-decoration: none;
      text-align: center;
      transition: all 0.25s ease;
    }
    .bottom-back a:hover{
      background: linear-gradient(90deg,var(--accent),var(--accent-2));
      color: #fff;
      border-color: transparent;
      transform: translateY(-3px);
    }

    /* ===== Modal de visualiza√ß√£o ===== */
    #listModal {
      display: none; /* fechado por padr√£o */
      position: fixed;
      z-index: 4000;
      inset: 0;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(3px);
      justify-content: center;
      align-items: center;
    }

    #listModal .modal-content {
      background: var(--panel);
      border: 2px solid var(--accent);
      border-radius: 20px;
      width: 90%;
      max-width: 700px;
      max-height: 85vh;
      overflow-y: auto;
      padding: 24px;
      box-shadow: 0 20px 50px rgba(0,0,0,.6);
      animation: scaleIn .25s ease;
      position: relative;
    }

    #listModal h3 {
      margin: 0 0 16px;
      padding-bottom: 10px;
      font-size: 22px;
      font-weight: 800;
      color: var(--accent);
      border-bottom: 1.5px solid var(--border);
      text-align: center;
    }

    #listModal p {
      margin: 0;
      font-size: 16px;
      line-height: 1.6;
      color: var(--text);
      white-space: pre-wrap;
    }

    /* Bot√£o fechar */
    #listModal .close-btn {
      position: absolute;
      top: 14px;
      right: 16px;
      font-size: 24px;
      font-weight: bold;
      background: none;
      border: none;
      cursor: pointer;
      color: var(--text);
      transition: transform .2s;
    }
    #listModal .close-btn:hover { transform: scale(1.2); color: var(--accent); }

    /* Anima√ß√£o */
    @keyframes scaleIn {
      from { transform: scale(0.9); opacity: 0; }
      to   { transform: scale(1); opacity: 1; }
    }

    /* ===== LISTA (melhorado) ===== */
    .list-item {
      display: flex;
      gap: 14px;
      padding: 16px 20px;
      background: var(--panel-2);
      border: 1px solid var(--border);
      border-radius: 16px;
      margin-bottom: 14px;
      transition: all .25s ease;
      box-shadow: 0 3px 8px rgba(0,0,0,.15);
      cursor: pointer;
    }
    .list-item:hover {
      transform: translateY(-2px);
      border-color: var(--accent);
      box-shadow: 0 6px 16px rgba(0,0,0,.25);
    }

    .list-icon {
      flex-shrink: 0;
      width: 42px; height: 42px;
      border-radius: 50%;
      background: var(--badge-bg);
      border: 1px solid var(--badge-border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: var(--accent);
    }

    .list-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .list-content h3 {
      margin: 0;
      font-size: 17px;
      font-weight: 700;
      color: var(--accent);
    }

    .list-content p {
      margin: 0;
      font-size: 15px;
      line-height: 1.5;
      color: var(--muted);
    }

    .list-item + .list-item {
      border-top: 1px solid rgba(255,255,255,0.05);
    }
    body[data-theme="light"] .list-item + .list-item {
      border-top: 1px solid #eee;
    }

  </style>
</head>
<body>
  <div class="container">
    <header>
      <div><h1>Tabula√ß√µes</h1></div>
      <div class="toolbar">
        <select id="viewMode" class="select">
          <option value="blocos">üóÇ Blocos</option>
          <option value="lista">üìã Lista</option>
        </select>
        <button id="btnToggleTheme" class="badge">üåó Tema</button>
        <button id="btnToggleAdm" class="badge" style="display:none;">‚öôÔ∏è ADM</button>
      </div>
      <div id="searchWrapper">
        <input id="searchInput" type="text" placeholder="üîç Pesquisar..." />
      </div>
    </header>

    <main id="tabulacoesList"></main>
  </div>

  <!-- Modal de visualiza√ß√£o da Lista -->
  <div id="listModal">
    <div class="modal-content">
      <button class="close-btn" id="closeListModal">‚úï</button>
      <h3 id="modalTitle"></h3>
      <p id="modalDesc"></p>
    </div>
  </div>

  <!-- >>> Bot√£o Voltar -->
  <div class="bottom-back">
    <a href="operador.html">‚¨ÖÔ∏è Voltar</a>
  </div>

  <script type="module">
    import { db, auth } from "./firebase.js";
    import {
      collection, query, orderBy, onSnapshot,
      addDoc, setDoc, deleteDoc, doc
    } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";

    const list = document.getElementById("tabulacoesList");
    const viewMode = document.getElementById("viewMode");
    const searchInput = document.getElementById("searchInput");
    const btnToggleTheme = document.getElementById("btnToggleTheme");
    const btnToggleAdm = document.getElementById("btnToggleAdm");

    let cacheDocs = [];
    let isAdmin = false;

    onAuthStateChanged(auth, user => {
      isAdmin = !!user;
      btnToggleAdm.style.display = isAdmin ? "" : "none";
    });

    const q = query(collection(db, "tabulacoes"), orderBy("titulo"));
    onSnapshot(q, (snap) => {
      cacheDocs = snap.docs;
      render();
    });

    function render(){
      const term = searchInput.value.toLowerCase();
      const docs = cacheDocs.filter(d=>{
        const t=d.data();
        return (t.titulo||"").toLowerCase().includes(term) || (t.descricao||"").toLowerCase().includes(term);
      });

      if(viewMode.value==="lista") renderLista(docs);
      else renderBlocos(docs);
    }

    function renderBlocos(docs){
      list.innerHTML = `<div class="stack-stage"><div class="stack-container" id="stackContainer"></div></div>`;
      const container = document.getElementById("stackContainer");

      docs.forEach((d)=>{
        const t = d.data();
        const card = document.createElement("div");
        card.className = "tab-card";
        card.innerHTML = `
          <button class="zoom-btn" title="Ampliar">üîç</button>
          <h3>${t.titulo || "(sem t√≠tulo)"}</h3>
          <p>${t.descricao || ""}</p>
        `;

        card.querySelector(".zoom-btn").addEventListener("click", (e)=>{
          e.stopPropagation();
          card.classList.toggle("zoomed");
        });
        document.addEventListener("keydown", (ev)=>{
          if(ev.key === "Escape") card.classList.remove("zoomed");
        });

        if(docs.length === 1){
          card.classList.add("centered");
        }

        container.appendChild(card);
      });
    }

    function renderLista(docs){
      list.innerHTML = "";
      docs.forEach(d=>{
        const t = d.data();
        const item = document.createElement("div");
        item.className = "list-item";
        item.innerHTML = `
          <div class="list-icon">üìå</div>
          <div class="list-content">
            <h3>${t.titulo || "(sem t√≠tulo)"}</h3>
            <p>${t.descricao || ""}</p>
          </div>
        `;

        item.addEventListener("click", ()=>{
          document.getElementById("modalTitle").textContent = t.titulo || "(sem t√≠tulo)";
          document.getElementById("modalDesc").textContent = t.descricao || "";
          document.getElementById("listModal").style.display = "flex";
        });

        list.appendChild(item);
      });
    }

    document.getElementById("closeListModal").addEventListener("click",()=>{
      document.getElementById("listModal").style.display="none";
    });
    window.addEventListener("keydown",(e)=>{
      if(e.key==="Escape") document.getElementById("listModal").style.display="none";
    });
    window.addEventListener("click",(e)=>{
      if(e.target.id==="listModal") document.getElementById("listModal").style.display="none";
    });

    searchInput.addEventListener("input", render);
    viewMode.addEventListener("change", render);

    (function(){
      const stored = localStorage.getItem("theme");
      if(stored) document.body.setAttribute("data-theme", stored);
      else if(window.matchMedia("(prefers-color-scheme: light)").matches)
        document.body.setAttribute("data-theme","light");
      else document.body.setAttribute("data-theme","dark");

      btnToggleTheme.addEventListener("click", ()=>{
        const cur = document.body.getAttribute("data-theme");
        const next = cur==="light" ? "dark" : "light";
        document.body.setAttribute("data-theme", next);
        localStorage.setItem("theme", next);
      });
    })();
  </script>
</body>
</html>
