<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Roteiro de Atendimento</title>
  <link rel="stylesheet" href="roteiro.css" />
  <link rel="icon" type="image/png" href="img/operador-de-telemarketing.png">
  <style>
  .title {
    font-size: clamp(34px, 5vw, 40px);
    font-weight: 900;
    text-align: center;
    margin: 10px 0 20px;
    background: linear-gradient(90deg,#00c853,#00e676);
    background-clip: text;           /*  vers√£o padr√£o */
    -webkit-background-clip: text;   /*  vers√£o para navegadores baseados em Webkit */
    -webkit-text-fill-color: transparent;
    color: transparent;              /* fallback */
    animation: glow-dark 3s infinite ease-in-out;
  }

  body[data-theme="light"] .title {
    background: linear-gradient(90deg,#ff5722,#ff9800);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    color: transparent;
    animation: glow-light 3s infinite ease-in-out;
  }

  @keyframes glow-dark {0%,100%{filter:drop-shadow(0 0 6px rgba(0,200,83,.5));}50%{filter:drop-shadow(0 0 18px rgba(0,200,83,.9));}}
  @keyframes glow-light {0%,100%{filter:drop-shadow(0 0 6px rgba(255,87,34,.5));}50%{filter:drop-shadow(0 0 18px rgba(255,87,34,.9));}}
  </style>
</head>
<body>
  <div class="container">
    <!-- Cabe√ßalho -->
    <header>
      <div><h1 class="title">Roteiro de Atendimento</h1></div>
      <div class="toolbar">
        <input type="text" id="searchInput" class="select" placeholder="üîç Pesquisar..." />
        <div class="jump" id="jumpWrapper">
          <span class="muted">Telas:</span>
          <select id="jumpSelect" class="select"></select>
          <button id="btnJumpBack" class="badge">‚èÆ Ir</button>
        </div>
        <button id="btnToggleTheme" class="badge">üåó Tema</button>
        <button id="btnToggleMode" class="badge">‚öôÔ∏è ADM</button>
        <a href="criar-usuario.html" class="badge">‚ûï Criar Operadores</a>
      </div>
    </header>

    <!-- Barra progresso -->
    <div class="progress"><div class="progressbar"><div id="bar"></div></div></div>

    <!-- Alerta -->
    <div id="tabAlert" class="tab-alert"><div class="msg">
      <b><i>Caso a liga√ß√£o seja interrompida ou cliente desligou, verifique a tabula√ß√£o no √≠cone (‚úî) abaixo</i></b> ‚¨áÔ∏è
    </div><span class="arrow"></span></div>

    <!-- Fluxo -->
    <main id="flow"></main>
    <div id="globalActions" class="global-actions"></div>

    <!-- Painel ADM -->
    <aside class="adm" id="admPanel">
      <header><div>Painel ADM</div><button id="btnAdmClose" class="badge">‚úï</button></header>
      <div class="tabs"><button data-tab="geral" class="tab active">‚öô Geral</button></div>
      <div class="tab-content active" id="tab-geral">
        <label>ID da tela</label><input type="text" id="fldId">
        <label>T√≠tulo da tela</label><input type="text" id="fldTitle">
        <div class="adm-toolbar">
          <button type="button" onclick="wrapText('fldBody','<b>','</b>')"><b>B</b></button>
          <button type="button" onclick="wrapText('fldBody','<i>','</i>')"><i>I</i></button>
          <button type="button" onclick="wrapText('fldBody','<u>','</u>')"><u>U</u></button>
          <button type="button" onclick="insertList('fldBody')">‚Ä¢ Lista</button>
          <button type="button" onclick="setColor('fldBody')">üé®</button>
        </div>
        <label>Texto do script</label><textarea id="fldBody"></textarea>
        <label>Tabula√ß√£o</label><input type="text" id="fldTab">

        <!-- NOVOS CAMPOS -->
        <label>Tamanho do texto (quadro)</label>
        <div class="control-group">
          <button type="button" onclick="adjustField('fldFontSizeBody',-2)">‚àí</button>
          <input type="number" id="fldFontSizeBody" min="12" max="40" value="18">
          <button type="button" onclick="adjustField('fldFontSizeBody',2)">+</button>
        </div>
        <label>Tamanho do texto (bot√µes)</label>
        <div class="control-group">
          <button type="button" onclick="adjustField('fldFontSizeButtons',-2)">‚àí</button>
          <input type="number" id="fldFontSizeButtons" min="10" max="30" value="16">
          <button type="button" onclick="adjustField('fldFontSizeButtons',2)">+</button>
        </div>
        <label>Tamanho do t√≠tulo</label>
        <div class="control-group">
          <button type="button" onclick="adjustField('fldFontSizeTitle',-2)">‚àí</button>
          <input type="number" id="fldFontSizeTitle" min="14" max="50" value="22">
          <button type="button" onclick="adjustField('fldFontSizeTitle',2)">+</button>
        </div>
        <label>Espa√ßamento interno (padding)</label>
        <div class="control-group">
          <button type="button" onclick="adjustField('fldPaddingBody',-2)">‚àí</button>
          <input type="number" id="fldPaddingBody" min="0" max="50" value="16">
          <button type="button" onclick="adjustField('fldPaddingBody',2)">+</button>
        </div>
        <label><input type="checkbox" id="chkShowJump"> Mostrar op√ß√£o de Telas</label>
      </div>

      <label>Bot√µes</label>
      <div id="fldButtons"></div>
      <button id="btnAddButton" class="btn-mini">+ Adicionar Bot√£o</button>

      <div class="adm-footer">
        <button id="btnSave" class="btn-mini primary">Salvar</button>
        <button id="btnReset" class="btn-mini">Recarregar</button>
        <button id="btnDelScreen" class="btn-mini danger">Remover Tela</button>
        <button id="btnLogout" class="btn-mini">Sair</button>
      </div>
    </aside>

    <script src="roteiro.js"></script>
  </div>

  <!-- Modal -->
  <div id="tabModal" class="modal">
    <div class="modal-content">
      <span id="closeModal" class="close">&times;</span>
      <h2>Tabula√ß√£o</h2><p id="modalText"></p>
    </div>
  </div>

  <div class="bottom-shortcuts">
    <a href="tabulacoes.html">üìë Tabula√ß√µes</a>
    <a href="situacoes.html">üìù Situa√ß√µes</a>
    <a href="canais.html">‚òéÔ∏è Canais</a>
    <button id="noteToggle">üìù Bloco de notas</button>
  </div>

  <!-- Painel Notas -->
  <div id="notePanel">
    <div id="noteToolbar">
      <button onclick="formatNote('bold')"><b>B</b></button>
      <button onclick="formatNote('italic')"><i>I</i></button>
      <button onclick="formatNote('underline')"><u>U</u></button>
      <button onclick="formatNote('insertUnorderedList')">‚Ä¢ Lista</button>
      <button id="noteClose">‚úï</button>
    </div>
    <div id="noteEditor" contenteditable="true"></div>
  </div>

<script type="module">
import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
import { app, db } from "./firebase.js";
import { doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

const auth=getAuth(app);
const btnLogout=document.getElementById("btnLogout");
const noteToggle=document.getElementById("noteToggle");
const notePanel=document.getElementById("notePanel");
const noteEditor=document.getElementById("noteEditor");
const noteClose=document.getElementById("noteClose");

let noteDocRef=null;

// Prote√ß√£o ADM
onAuthStateChanged(auth,(user)=>{
  if(!user){ window.location.href="login.html"; return; }
  noteDocRef=doc(db,"anotacoes",user.uid); // usa UID real
  loadNotes();
});

// Logout
btnLogout?.addEventListener("click",async()=>{
  try{ await signOut(auth); window.location.href="login.html"; }
  catch(e){ alert("Erro ao sair: "+e.message); }
});

// Notas
noteToggle.addEventListener("click",()=>notePanel.classList.toggle("active"));
noteClose?.addEventListener("click",()=>notePanel.classList.remove("active"));

window.formatNote=(cmd)=>{ document.execCommand(cmd,false,null); saveNotes(); };

async function saveNotes(){
  if(!noteDocRef) return;
  try{
    await setDoc(noteDocRef,{conteudo:noteEditor.innerHTML,atualizado:new Date().toISOString()});
  }catch(e){ console.error("Erro salvar:",e); }
}

async function loadNotes(){
  if(!noteDocRef) return;
  try{
    const snap=await getDoc(noteDocRef);
    if(snap.exists()) noteEditor.innerHTML=snap.data().conteudo||"";
  }catch(e){ console.error("Erro carregar:",e); }
}
noteEditor.addEventListener("input", saveNotes);
</script>

<script>
function wrapText(fieldId,before,after){
  const t=document.getElementById(fieldId);
  const s=t.selectionStart,e=t.selectionEnd;
  const sel=t.value.substring(s,e);
  t.setRangeText(before+sel+after,s,e,'end'); t.focus();
}
function insertList(fieldId){
  const t=document.getElementById(fieldId);
  const s=t.selectionStart,e=t.selectionEnd;
  const sel=t.value.substring(s,e);
  const lines=sel.split("\n").map(l=>l?`<li>${l}</li>`:"").join("\n");
  t.setRangeText(`<ul>\n${lines}\n</ul>`,s,e,'end'); t.focus();
}
function setColor(fieldId){
  const c=prompt("Digite a cor (ex: red, #ff0000):","#ff0000");
  if(!c) return;
  wrapText(fieldId,`<span style="color:${c}">`,`</span>`);
}
</script>
</body>
</html>
