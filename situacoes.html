<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" type="image/png" href="img/operador-de-telemarketing.png">
  <title>Situa√ß√µes</title>
  <style>
    :root{
      --bg:#0f1113; --panel:#15181b; --panel-2:#1b2024; --text:#f5f7fa; --muted:#aab0b6;
      --border:#22292f; --badge-bg:#21272d; --badge-border:#2a3138;
      --accent:#00c853; --accent-2:#00e676; --shadow:0 12px 34px rgba(0,0,0,.35);
    }
    body[data-theme="light"]{
      --bg:#fff; --panel:#fff; --panel-2:#f7f7f8; --text:#1b1f24; --muted:#666;
      --border:#e5e7eb; --badge-bg:#f3f4f6; --badge-border:#e5e7eb;
      --accent:#ff6d00; --accent-2:#ffa000; --shadow:0 8px 20px rgba(0,0,0,.08);
    }

    *{ box-sizing:border-box }
    body{
      margin:0; font-family:system-ui,Roboto,Arial,sans-serif;
      background:var(--bg); color:var(--text);
      min-height:100vh; padding:20px; display:flex; justify-content:center;
    }
    .container{ width:100%; max-width:1000px }

    header{ display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:8px; margin-bottom:16px }
    header h1{ margin:0; font-size:22px; color:var(--accent) }

    .toolbar{ display:flex; gap:8px; flex-wrap:wrap }
    .select,.badge{
      border:1px solid var(--badge-border); background:var(--panel-2); color:var(--text);
      padding:8px 12px; border-radius:10px; cursor:pointer;
    }

    /* >>> Bot√£o Voltar */
    .bottom-back{
      position: fixed;
      left: 50%;
      bottom: 20px;
      transform: translateX(-50%);
      z-index: 1900;
    }
    .bottom-back a{
      display: inline-block;
      background: var(--panel);
      border: 2px solid var(--accent);
      color: var(--accent);
      padding: 14px 28px;
      border-radius: 20px;
      font-size: 16px;
      font-weight: 600;
      text-decoration: none;
      text-align: center;
      box-shadow: 0 4px 10px rgba(0,0,0,.25);
      transition: all 0.25s ease;
    }
    .bottom-back a:hover{
      background: linear-gradient(90deg,var(--accent),var(--accent-2));
      color: #fff;
      border-color: transparent;
      transform: translateY(-3px);
    }

    /* GRID */
    .grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:14px }
    .card{
      background:var(--panel); border:1px solid var(--border);
      border-radius:12px; padding:14px 18px;
      cursor:pointer; transition:background .25s ease, transform .2s ease;
      position:relative; overflow:hidden;
    }
    .card:hover{ background:var(--panel-2); transform:translateY(-2px) }

    .card h3{
      margin:0 0 6px;
      font-size:18px;
      font-weight:700;
      color:var(--accent);
      display:flex;
      align-items:center;
      justify-content:space-between;
    }

    .badge-cat{
      font-size:12px;
      font-weight:600;
      padding:4px 10px;
      border-radius:20px;
      color:#fff;
      background:var(--accent);
    }


    /* MODAL */
    .modal-backdrop{
      position:fixed; inset:0; background:rgba(0,0,0,.75);
      display:none; align-items:center; justify-content:center; z-index:2000; padding:20px;
    }
    .modal-backdrop.open{ display:flex }
    .modal{
      background:var(--panel); border-radius:20px; padding:28px 24px;
      max-width:900px; width:100%; max-height:85vh; overflow-y:auto; box-shadow:var(--shadow);
      animation:fadeIn .25s ease;
    }
    .modal h2{ margin-top:0; font-size:24px; color:var(--accent) }
    .modal .meta{ margin:0 0 12px }
    .modal p{ margin:14px 0 0; line-height:1.75; font-size:16px; white-space:pre-wrap }
    @keyframes fadeIn{ from{opacity:0; transform:translateY(12px) scale(.98)} to{opacity:1; transform:translateY(0) scale(1)} }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Situa√ß√µes</h1>
      <div class="toolbar">
        <select id="filterCategoria" class="select"></select>
        <input id="searchInput" class="select" type="text" placeholder="üîç Pesquisar..." />
        <button id="btnToggleTheme" class="badge">üåó Tema</button>
      </div>
    </header>

    <main id="situacoesList" class="grid"></main>
  </div>

  <!-- Modal -->
  <div id="modalBackdrop" class="modal-backdrop">
    <div class="modal">
      <h2 id="modalTitle"></h2>
      <div id="modalMeta" class="meta"></div>
      <p id="modalDesc"></p>
      <footer>
        <button id="btnCloseModal" class="badge">Fechar</button>
      </footer>
    </div>
  </div>

  <!-- Bot√£o Voltar -->
  <div class="bottom-back">
    <a href="operador.html" class="btn">‚¨ÖÔ∏è Voltar</a>
  </div>

  <script type="module">
    import { db } from "./firebase.js";
    import { collection, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

    const list = document.getElementById("situacoesList");
    const searchInput = document.getElementById("searchInput");
    const filterCategoria = document.getElementById("filterCategoria");

    const modalBackdrop = document.getElementById("modalBackdrop");
    const modalTitle = document.getElementById("modalTitle");
    const modalMeta = document.getElementById("modalMeta");
    const modalDesc = document.getElementById("modalDesc");
    const btnCloseModal = document.getElementById("btnCloseModal");

    let cacheDocs = [];
    let cacheCats = [];

    /* categorias */
    const qCats = query(collection(db,"categorias"), orderBy("nome"));
    onSnapshot(qCats,(snap)=>{
      cacheCats = snap.docs;
      renderCategoriasSelect();
    });

    function renderCategoriasSelect(){
      filterCategoria.innerHTML = "";
      const optAll = document.createElement("option");
      optAll.value = "todas";
      optAll.textContent = "Todas";
      filterCategoria.appendChild(optAll);
      cacheCats.forEach(c=>{
        const opt=document.createElement("option");
        opt.value=c.id; opt.textContent=c.data().nome;
        filterCategoria.appendChild(opt);
      });
      filterCategoria.value="todas";
    }

    /* situa√ß√µes */
    const q = query(collection(db,"situacoes"), orderBy("titulo"));
    onSnapshot(q,(snap)=>{ cacheDocs = snap.docs; render(); });

    function render(){
      const term = searchInput.value.toLowerCase();
      const filtroCat = filterCategoria.value;
      const docs = cacheDocs.filter(d=>{
        const t=d.data();
        const matchSearch = (t.titulo||"").toLowerCase().includes(term) || (t.descricao||"").toLowerCase().includes(term);
        const matchCategoria = (filtroCat==="todas") || (t.categoria === filtroCat);
        return matchSearch && matchCategoria;
      });
      list.innerHTML = "";
      docs.forEach(d=>{
        const t = d.data();
        const cat = cacheCats.find(c=>c.id===t.categoria)?.data()?.nome || "Sem categoria";
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
        <h3>
        ${t.titulo || "(sem t√≠tulo)"}
        <span class="badge-cat">${cat}</span>
        </h3>
        <p>${t.descricao || ""}</p>`;
        card.addEventListener("click", ()=>openModal(d.id,t,cat));
        list.appendChild(card);
      });
    }

    function openModal(id,data,catNome){
      modalTitle.textContent = data.titulo || "(sem t√≠tulo)";
      modalDesc.textContent = data.descricao || "";
      modalMeta.textContent = "Categoria: " + (catNome || "Sem categoria");
      modalBackdrop.classList.add("open");
    }
    btnCloseModal.addEventListener("click", ()=> modalBackdrop.classList.remove("open"));
    modalBackdrop.addEventListener("click", e=>{ if(e.target===modalBackdrop) modalBackdrop.classList.remove("open"); });

    /* tema */
    (function(){
      const btnToggleTheme=document.getElementById("btnToggleTheme");
      const stored=localStorage.getItem("theme");
      if(stored) document.body.setAttribute("data-theme",stored);
      else if(window.matchMedia("(prefers-color-scheme: light)").matches)
        document.body.setAttribute("data-theme","light");
      else document.body.setAttribute("data-theme","dark");
      btnToggleTheme.addEventListener("click",()=>{
        const cur=document.body.getAttribute("data-theme");
        const next=cur==="light"?"dark":"light";
        document.body.setAttribute("data-theme",next);
        localStorage.setItem("theme",next);
      });
    })();

    /* search + filtro */
    searchInput.addEventListener("input", render);
    filterCategoria.addEventListener("change", render);
  </script>
</body>
</html>
