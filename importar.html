<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Importar Roteiros para Firestore</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f9f9f9; }
    h2 { color: #333; }
    input, button { padding: 10px; font-size: 16px; margin: 5px 0; }
    input { width: 300px; }
    button { cursor: pointer; border: none; border-radius: 6px; margin-right: 8px; }
    #btnImportar { background: #ff5722; color: #fff; }
    #btnImportar:hover { background: #e64a19; }
    #btnLimpar { background: #e53935; color: #fff; }
    #btnLimpar:hover { background: #c62828; }
    pre { background: #222; color: #0f0; padding: 10px; border-radius: 6px; max-height: 400px; overflow-y: auto; }
  </style>
</head>
<body>
  <h2>üöÄ Importar roteiros JSON para Firestore</h2>

  <label for="jsonFile">Nome do arquivo JSON:</label><br>
  <input type="text" id="jsonFile" value="roteiros.json" /><br>
  
  <button id="btnImportar">Iniciar Importa√ß√£o</button>
  <button id="btnLimpar">üóë Limpar cole√ß√£o</button>

  <pre id="log"></pre>

  <script type="module">
    import { db } from "./firebase.js";
    import { collection, getDocs, doc, setDoc, deleteDoc } 
      from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

    const log = document.getElementById("log");

    // =========================
    // Importar roteiros do JSON
    // =========================
    async function importarRoteiros() {
      const fileName = document.getElementById("jsonFile").value.trim();
      if (!fileName) {
        log.textContent = "‚ö†Ô∏è Digite o nome de um arquivo JSON.";
        return;
      }
      log.textContent = `‚è≥ Carregando ${fileName}...\n`;

      try {
        const resp = await fetch(fileName);
        if (!resp.ok) throw new Error("Erro ao carregar " + fileName);
        const json = await resp.json();

        let total = 0;
        for (const [produto, telasObj] of Object.entries(json.marcas || {})) {
          for (const tela of Object.values(telasObj)) {
            if (!tela?.id) continue;
            const def = { ...tela, product: produto };
            await setDoc(doc(db, "roteiros", def.id), def, { merge: true });
            log.textContent += `‚úî Importado: ${def.id}\n`;
            total++;
          }
        }

        log.textContent += `\n‚úÖ Importa√ß√£o conclu√≠da. ${total} telas salvas no Firestore.`;
      } catch (e) {
        log.textContent += `\n‚ùå Erro: ${e.message}`;
        console.error(e);
      }
    }

    // =========================
    // Limpar toda a cole√ß√£o
    // =========================
    async function limparColecao() {
      if (!confirm("‚ö†Ô∏è Isso vai apagar TODAS as telas da cole√ß√£o 'roteiros'. Deseja continuar?")) return;
      log.textContent = "‚è≥ Apagando documentos da cole√ß√£o 'roteiros'...\n";
      try {
        const snap = await getDocs(collection(db, "roteiros"));
        let count = 0;
        for (const d of snap.docs) {
          await deleteDoc(doc(db, "roteiros", d.id));
          log.textContent += `üóë Apagado: ${d.id}\n`;
          count++;
        }
        log.textContent += `\n‚úÖ Limpeza conclu√≠da. ${count} documentos removidos.`;
      } catch (e) {
        log.textContent += `\n‚ùå Erro ao limpar: ${e.message}`;
        console.error(e);
      }
    }

    document.getElementById("btnImportar").addEventListener("click", importarRoteiros);
    document.getElementById("btnLimpar").addEventListener("click", limparColecao);
  </script>
</body>
</html>
