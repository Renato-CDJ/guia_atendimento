<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Roteiro de Atendimento - Operador</title>
  <link rel="stylesheet" href="roteiro.css" />
  <link rel="icon" href="data:,">
</head>
<body data-role="operador">
  <div class="container">
    <!-- Cabe√ßalho -->
    <header>
      <div><h1>Roteiro de Atendimento</h1></div>
      <div class="toolbar">
        <input type="text" id="searchInput" class="select" placeholder="üîç Pesquisar..." />
        
        <button id="btnToggleTheme" class="badge">üåó Tema</button>
      </div>
    </header>

    <!-- Barra de progresso -->
    <div class="progress">
      <div class="progressbar"><div id="bar"></div></div>
    </div>

    <!-- Alerta -->
    <div id="tabAlert" class="tab-alert">
      <div class="msg">
        Caso a liga√ß√£o seja interrompida ou cliente desligou, verifique a tabula√ß√£o no √≠cone abaixo ‚úî
      </div>
      <span class="arrow"></span>
    </div>

    <!-- Fluxo -->
    <main id="flow"></main>

    <!-- üîπ Container dos bot√µes globais (mantido igual ao index) -->
    <div id="globalActions" class="global-actions"></div>
  </div>

  <!-- Modal de Tabula√ß√£o -->
  <div id="tabModal" class="modal">
    <div class="modal-content">
      <span id="closeModal" class="close">&times;</span>
      <h2>Tabula√ß√£o</h2>
      <p id="modalText"></p>
    </div>
  </div>

  <!-- Atalhos -->
  <div class="bottom-shortcuts">
    <a href="tabulacoes.html">üìë Tabula√ß√µes</a>
    <a href="situacoes.html">üìù Situa√ß√µes</a>
    <a href="canais.html">‚òéÔ∏è Canais</a>
    <button id="noteToggle">üìù Bloco de notas</button>
  </div>

  <!-- Painel de Notas -->
  <div id="notePanel">
    <div id="noteToolbar">
      <button onclick="formatNote('bold')"><b>B</b></button>
      <button onclick="formatNote('italic')"><i>I</i></button>
      <button onclick="formatNote('underline')"><u>U</u></button>
      <button onclick="formatNote('insertUnorderedList')">‚Ä¢ Lista</button>
      <button id="noteClose">‚úï</button>
    </div>
    <div id="noteEditor" contenteditable="true"></div>
  </div>

  <!-- App -->
  <script src="roteiro.js"></script>

  <!-- Bloco de notas (√∫nica √°rea edit√°vel) -->
  <script type="module">
    import { db } from "./firebase.js";
    import { doc, getDoc, setDoc }
      from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

    const noteToggle = document.getElementById("noteToggle");
    const notePanel  = document.getElementById("notePanel");
    const noteEditor = document.getElementById("noteEditor");
    const noteClose  = document.getElementById("noteClose");

    noteToggle.addEventListener("click", () => notePanel.classList.toggle("active"));
    noteClose?.addEventListener("click", () => notePanel.classList.remove("active"));

    window.formatNote = (cmd) => {
      document.execCommand(cmd, false, null);
      saveNotes();
    };

    const noteDocRef = doc(db, "anotacoes", "operador");

    async function saveNotes() {
      try {
        await setDoc(noteDocRef, {
          conteudo: noteEditor.innerHTML,
          atualizado: new Date().toISOString()
        });
        console.log("Nota salva no Firestore!");
      } catch (e) { console.error("Erro ao salvar nota:", e); }
    }

    async function loadNotes() {
      try {
        const snap = await getDoc(noteDocRef);
        if (snap.exists()) noteEditor.innerHTML = snap.data().conteudo || "";
      } catch (e) { console.error("Erro ao carregar nota:", e); }
    }

    noteEditor.addEventListener("input", saveNotes);
    loadNotes();
  </script>

  <script>
  // ===== Aplicar tema salvo no localStorage =====
  const savedTheme = localStorage.getItem("theme") || "dark";
  if (savedTheme === "light") {
    document.body.setAttribute("data-theme","light");
  } else {
    document.body.removeAttribute("data-theme");
  }

  // ===== Alternar tema pelo bot√£o j√° existente =====
  const btnToggleTheme = document.getElementById("btnToggleTheme");
  if (btnToggleTheme) {
    btnToggleTheme.addEventListener("click", () => {
      const current = localStorage.getItem("theme") || "dark";
      const newTheme = current === "dark" ? "light" : "dark";
      localStorage.setItem("theme", newTheme);
      if (newTheme === "light") {
        document.body.setAttribute("data-theme","light");
      } else {
        document.body.removeAttribute("data-theme");
      }
    });
  }
</script>

</body>
</html>
